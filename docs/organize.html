<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Organizing migrations · Underbase</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Organizing your migrations workflow is quite easy using configuration files and versionned folders. For example, the CLI consider the following structure by default :&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Organizing migrations · Underbase"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sundowndev.github.io/underbase/"/><meta property="og:description" content="&lt;p&gt;Organizing your migrations workflow is quite easy using configuration files and versionned folders. For example, the CLI consider the following structure by default :&lt;/p&gt;
"/><meta property="og:image" content="https://sundowndev.github.io/underbase/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sundowndev.github.io/underbase/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/underbase/img/logo.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://sundowndev.github.io/underbase/blog/atom.xml" title="Underbase Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://sundowndev.github.io/underbase/blog/feed.xml" title="Underbase Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/underbase/js/scrollSpy.js"></script><link rel="stylesheet" href="/underbase/css/main.css"/><script src="/underbase/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/underbase/"><img class="logo" src="/underbase/img/logo.svg" alt="Underbase"/><h2 class="headerTitleWithLogo">Underbase</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/underbase/docs/installation" target="_self">Guides</a></li><li class="siteNavGroupActive"><a href="/underbase/docs/api" target="_self">API</a></li><li class=""><a href="/underbase/blog/" target="_self">Release notes</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/underbase/docs/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/writting-migrations">Writting migrations</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/advanced">Advanced usage</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/module-usage">Module usage</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/troubleshooting">Troubleshooting</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/underbase/docs/organize">Organizing migrations</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/backups">Working with backups</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/continuous-deployment">Working with continuous deployment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/underbase/docs/api">Module</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/query-api">Query Interface</a></li><li class="navListItem"><a class="navItem" href="/underbase/docs/api-dev">Module for development</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Organizing migrations</h1></header><article><div><span><p>Organizing your migrations workflow is quite easy using configuration files and versionned folders. For example, the CLI consider the following structure by default :</p>
<pre><code class="hljs">migrations
└── api &lt;-- your database
    └── <span class="hljs-number">1.0</span>
        ├── index<span class="hljs-selector-class">.js</span> &lt;-- entry file to execute migrations
        ├── articles<span class="hljs-selector-class">.js</span>
        ├── users<span class="hljs-selector-class">.js</span>
        └── tags<span class="hljs-selector-class">.js</span>
    └── <span class="hljs-number">1.1</span>
        ├── index<span class="hljs-selector-class">.js</span>
        ├── articles<span class="hljs-selector-class">.js</span>
    └── <span class="hljs-number">2.0</span> &lt;-- major version
        ├── index<span class="hljs-selector-class">.js</span>
        ├── articles<span class="hljs-selector-class">.js</span>
        ├── users<span class="hljs-selector-class">.js</span>
        └── logs<span class="hljs-selector-class">.js</span>
└── api<span class="hljs-selector-class">.json</span> &lt;-- configuration file
</code></pre>
<p><img src="https://i.imgur.com/iJWGEDS.png" alt=""></p>
<p><img src="https://i.imgur.com/bkHGZPZ.png" alt=""></p>
<p><img src="https://i.imgur.com/QBqoyU7.png" alt=""></p>
<p><img src="https://i.imgur.com/FhUQD01.png" alt=""></p>
<p>The index file for each migration version is intended to register the version and execute all migrations. This allows you to choose the execution order and add some actions between migrations.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Import collections mirgations</span>
<span class="hljs-keyword">import</span> users <span class="hljs-keyword">from</span> <span class="hljs-string">'./users'</span>;
<span class="hljs-keyword">import</span> articles <span class="hljs-keyword">from</span> <span class="hljs-string">'./articles'</span>;
<span class="hljs-keyword">import</span> logs <span class="hljs-keyword">from</span> <span class="hljs-string">'./logs'</span>;
<span class="hljs-keyword">import</span> tags <span class="hljs-keyword">from</span> <span class="hljs-string">'./tags'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">version</span>: <span class="hljs-number">1.0</span>,
  <span class="hljs-attr">describe</span>: <span class="hljs-string">'Init collections'</span>,
  <span class="hljs-attr">up</span>: <span class="hljs-keyword">async</span> ({ Migrate }) =&gt; {
    <span class="hljs-comment">// ... do something</span>

    <span class="hljs-keyword">await</span> Migrate([articles, logs, users, tags]);

    <span class="hljs-comment">// ... do something</span>
  },
  <span class="hljs-attr">down</span>: <span class="hljs-keyword">async</span> ({ Migrate }) =&gt; {
    <span class="hljs-keyword">await</span> Migrate([articles, logs, users, tags]);
  },
};
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/underbase/docs/troubleshooting"><span class="arrow-prev">← </span><span>Troubleshooting</span></a><a class="docs-next button" href="/underbase/docs/backups"><span>Working with backups</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/underbase/" class="nav-home"><img src="/underbase/img/logo.svg" alt="Underbase" width="64" height="auto"/></a><div><h5>Guides</h5><a href="/underbase/docs/backups">Working with backups</a><a href="/underbase/docs/continuous-deployment">Working with continuous deployment</a><a href="/underbase/docs/api">API Reference</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/underbase" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/sundowndev" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/underbase/blog">Release notes</a><a href="https://github.com/sundowndev/underbase">GitHub</a></div></section></footer></div></body></html>