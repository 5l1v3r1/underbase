<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>node_modules/http-cache-semantics/README · Underbase</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;can-i-cache-this-build-status-https-travis-ciorg-pornel-http-cache-semanticssvgbranch-master-https-travis-ciorg-pornel-http-cache-semantics&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#can-i-cache-this-build-status-https-travis-ciorg-pornel-http-cache-semanticssvgbranch-master-https-travis-ciorg-pornel-http-cache-semantics&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can I cache this? &lt;a href=&quot;https://travis-ci.org/pornel/http-cache-semantics&quot;&gt;&lt;img src=&quot;https://travis-ci.org/pornel/http-cache-semantics.svg?branch=master&quot; alt=&quot;Build Status&quot;&gt;&lt;/a&gt;&lt;/h1&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="node_modules/http-cache-semantics/README · Underbase"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sundowndev.github.io/underbase/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;can-i-cache-this-build-status-https-travis-ciorg-pornel-http-cache-semanticssvgbranch-master-https-travis-ciorg-pornel-http-cache-semantics&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#can-i-cache-this-build-status-https-travis-ciorg-pornel-http-cache-semanticssvgbranch-master-https-travis-ciorg-pornel-http-cache-semantics&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can I cache this? &lt;a href=&quot;https://travis-ci.org/pornel/http-cache-semantics&quot;&gt;&lt;img src=&quot;https://travis-ci.org/pornel/http-cache-semantics.svg?branch=master&quot; alt=&quot;Build Status&quot;&gt;&lt;/a&gt;&lt;/h1&gt;
"/><meta property="og:image" content="https://sundowndev.github.io/underbase/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sundowndev.github.io/underbase/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/underbase/img/logo.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://sundowndev.github.io/underbase/blog/atom.xml" title="Underbase Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://sundowndev.github.io/underbase/blog/feed.xml" title="Underbase Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/underbase/js/scrollSpy.js"></script><link rel="stylesheet" href="/underbase/css/main.css"/><script src="/underbase/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/underbase/"><img class="logo" src="/underbase/img/logo.svg" alt="Underbase"/><h2 class="headerTitleWithLogo">Underbase</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/underbase/docs/installation" target="_self">Guides</a></li><li class=""><a href="/underbase/docs/api" target="_self">API</a></li><li class=""><a href="/underbase/blog/" target="_self">Release notes</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">node_modules/http-cache-semantics/README</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="can-i-cache-this-build-status-https-travis-ciorg-pornel-http-cache-semanticssvgbranch-master-https-travis-ciorg-pornel-http-cache-semantics"></a><a href="#can-i-cache-this-build-status-https-travis-ciorg-pornel-http-cache-semanticssvgbranch-master-https-travis-ciorg-pornel-http-cache-semantics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Can I cache this? <a href="https://travis-ci.org/pornel/http-cache-semantics"><img src="https://travis-ci.org/pornel/http-cache-semantics.svg?branch=master" alt="Build Status"></a></h1>
<p><code>CachePolicy</code> tells when responses can be reused from a cache, taking into account <a href="http://httpwg.org/specs/rfc7234.html">HTTP RFC 7234</a> rules for user agents and shared caches. It's aware of many tricky details such as the <code>Vary</code> header, proxy revalidation, and authenticated responses.</p>
<h2><a class="anchor" aria-hidden="true" id="usage"></a><a href="#usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Usage</h2>
<p>Cacheability of an HTTP response depends on how it was requested, so both <code>request</code> and <code>response</code> are required to create the policy.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> policy = <span class="hljs-keyword">new</span> CachePolicy(request, response, options);

<span class="hljs-keyword">if</span> (!policy.storable()) {
    <span class="hljs-comment">// throw the response away, it's not usable at all</span>
    <span class="hljs-keyword">return</span>;
}

<span class="hljs-comment">// Cache the data AND the policy object in your cache</span>
<span class="hljs-comment">// (this is pseudocode, roll your own cache (lru-cache package works))</span>
letsPretendThisIsSomeCache.set(request.url, {policy, response}, policy.timeToLive());
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// And later, when you receive a new request:</span>
<span class="hljs-keyword">const</span> {policy, response} = letsPretendThisIsSomeCache.get(newRequest.url);

<span class="hljs-comment">// It's not enough that it exists in the cache, it has to match the new request, too:</span>
<span class="hljs-keyword">if</span> (policy &amp;&amp; policy.satisfiesWithoutRevalidation(newRequest)) {
    <span class="hljs-comment">// OK, the previous response can be used to respond to the `newRequest`.</span>
    <span class="hljs-comment">// Response headers have to be updated, e.g. to add Age and remove uncacheable headers.</span>
    response.headers = policy.responseHeaders();
    <span class="hljs-keyword">return</span> response;
}
</code></pre>
<p>It may be surprising, but it's not enough for an HTTP response to be <a href="#yo-fresh">fresh</a> to satisfy a request. It may need to match request headers specified in <code>Vary</code>. Even a matching fresh response may still not be usable if the new request restricted cacheability, etc.</p>
<p>The key method is <code>satisfiesWithoutRevalidation(newRequest)</code>, which checks whether the <code>newRequest</code> is compatible with the original request and whether all caching conditions are met.</p>
<h3><a class="anchor" aria-hidden="true" id="constructor-options"></a><a href="#constructor-options" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Constructor options</h3>
<p>Request and response must have a <code>headers</code> property with all header names in lower case. <code>url</code>, <code>status</code> and <code>method</code> are optional (defaults are any URL, status <code>200</code>, and <code>GET</code> method).</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> request = {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-attr">accept</span>: <span class="hljs-string">'*/*'</span>,
    },
};

<span class="hljs-keyword">const</span> response = {
    <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'cache-control'</span>: <span class="hljs-string">'public, max-age=7234'</span>,
    },
};

<span class="hljs-keyword">const</span> options = {
    <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">cacheHeuristic</span>: <span class="hljs-number">0.1</span>,
    <span class="hljs-attr">immutableMinTimeToLive</span>: <span class="hljs-number">24</span>*<span class="hljs-number">3600</span>*<span class="hljs-number">1000</span>, <span class="hljs-comment">// 24h</span>
    ignoreCargoCult: <span class="hljs-literal">false</span>,
};
</code></pre>
<p>If <code>options.shared</code> is <code>true</code> (default), then the response is evaluated from a perspective of a shared cache (i.e. <code>private</code> is not cacheable and <code>s-maxage</code> is respected). If <code>options.shared</code> is <code>false</code>, then the response is evaluated from a perspective of a single-user cache (i.e. <code>private</code> is cacheable and <code>s-maxage</code> is ignored).</p>
<p><code>options.cacheHeuristic</code> is a fraction of response's age that is used as a fallback cache duration. The default is 0.1 (10%), e.g. if a file hasn't been modified for 100 days, it'll be cached for 100*0.1 = 10 days.</p>
<p><code>options.immutableMinTimeToLive</code> is a number of milliseconds to assume as the default time to cache responses with <code>Cache-Control: immutable</code>. Note that <a href="http://httpwg.org/http-extensions/immutable.html">per RFC</a> these can become stale, so <code>max-age</code> still overrides the default.</p>
<p>If <code>options.ignoreCargoCult</code> is true, common anti-cache directives will be completely ignored if the non-standard <code>pre-check</code> and <code>post-check</code> directives are present. These two useless directives are most commonly found in bad StackOverflow answers and PHP's &quot;session limiter&quot; defaults.</p>
<h3><a class="anchor" aria-hidden="true" id="storable"></a><a href="#storable" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>storable()</code></h3>
<p>Returns <code>true</code> if the response can be stored in a cache. If it's <code>false</code> then you MUST NOT store either the request or the response.</p>
<h3><a class="anchor" aria-hidden="true" id="satisfieswithoutrevalidationnewrequest"></a><a href="#satisfieswithoutrevalidationnewrequest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>satisfiesWithoutRevalidation(newRequest)</code></h3>
<p>This is the most important method. Use this method to check whether the cached response is still fresh in the context of the new request.</p>
<p>If it returns <code>true</code>, then the given <code>request</code> matches the original response this cache policy has been created with, and the response can be reused without contacting the server. Note that the old response can't be returned without being updated, see <code>responseHeaders()</code>.</p>
<p>If it returns <code>false</code>, then the response may not be matching at all (e.g. it's for a different URL or method), or may require to be refreshed first (see <code>revalidationHeaders()</code>).</p>
<h3><a class="anchor" aria-hidden="true" id="responseheaders"></a><a href="#responseheaders" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>responseHeaders()</code></h3>
<p>Returns updated, filtered set of response headers to return to clients receiving the cached response. This function is necessary, because proxies MUST always remove hop-by-hop headers (such as <code>TE</code> and <code>Connection</code>) and update response's <code>Age</code> to avoid doubling cache time.</p>
<pre><code class="hljs css language-js">cachedResponse.headers = cachePolicy.responseHeaders(cachedResponse);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="timetolive"></a><a href="#timetolive" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>timeToLive()</code></h3>
<p>Returns approximate time in <em>milliseconds</em> until the response becomes stale (i.e. not fresh).</p>
<p>After that time (when <code>timeToLive() &lt;= 0</code>) the response might not be usable without revalidation. However, there are exceptions, e.g. a client can explicitly allow stale responses, so always check with <code>satisfiesWithoutRevalidation()</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="toobject-fromobjectjson"></a><a href="#toobject-fromobjectjson" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>toObject()</code>/<code>fromObject(json)</code></h3>
<p>Chances are you'll want to store the <code>CachePolicy</code> object along with the cached response. <code>obj = policy.toObject()</code> gives a plain JSON-serializable object. <code>policy = CachePolicy.fromObject(obj)</code> creates an instance from it.</p>
<h3><a class="anchor" aria-hidden="true" id="refreshing-stale-cache-revalidation"></a><a href="#refreshing-stale-cache-revalidation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refreshing stale cache (revalidation)</h3>
<p>When a cached response has expired, it can be made fresh again by making a request to the origin server. The server may respond with status 304 (Not Modified) without sending the response body again, saving bandwidth.</p>
<p>The following methods help perform the update efficiently and correctly.</p>
<h4><a class="anchor" aria-hidden="true" id="revalidationheadersnewrequest"></a><a href="#revalidationheadersnewrequest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>revalidationHeaders(newRequest)</code></h4>
<p>Returns updated, filtered set of request headers to send to the origin server to check if the cached response can be reused. These headers allow the origin server to return status 304 indicating the response is still fresh. All headers unrelated to caching are passed through as-is.</p>
<p>Use this method when updating cache from the origin server.</p>
<pre><code class="hljs css language-js">updateRequest.headers = cachePolicy.revalidationHeaders(updateRequest);
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="revalidatedpolicyrevalidationrequest-revalidationresponse"></a><a href="#revalidatedpolicyrevalidationrequest-revalidationresponse" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>revalidatedPolicy(revalidationRequest, revalidationResponse)</code></h4>
<p>Use this method to update the cache after receiving a new response from the origin server. It returns an object with two keys:</p>
<ul>
<li><code>policy</code> — A new <code>CachePolicy</code> with HTTP headers updated from <code>revalidationResponse</code>. You can always replace the old cached <code>CachePolicy</code> with the new one.</li>
<li><code>modified</code> — Boolean indicating whether the response body has changed.
<ul>
<li>If <code>false</code>, then a valid 304 Not Modified response has been received, and you can reuse the old cached response body.</li>
<li>If <code>true</code>, you should use new response's body (if present), or make another request to the origin server without any conditional headers (i.e. don't use <code>revalidationHeaders()</code> this time) to get the new resource.</li>
</ul></li>
</ul>
<pre><code class="hljs css language-js"><span class="hljs-comment">// When serving requests from cache:</span>
<span class="hljs-keyword">const</span> {oldPolicy, oldResponse} = letsPretendThisIsSomeCache.get(newRequest.url);

<span class="hljs-keyword">if</span> (!oldPolicy.satisfiesWithoutRevalidation(newRequest)) {
    <span class="hljs-comment">// Change the request to ask the origin server if the cached response can be used</span>
    newRequest.headers = oldPolicy.revalidationHeaders(newRequest);

    <span class="hljs-comment">// Send request to the origin server. The server may respond with status 304</span>
    <span class="hljs-keyword">const</span> newResponse = <span class="hljs-keyword">await</span> makeRequest(newResponse);

    <span class="hljs-comment">// Create updated policy and combined response from the old and new data</span>
    <span class="hljs-keyword">const</span> {policy, modified} = oldPolicy.revalidatedPolicy(newRequest, newResponse);
    <span class="hljs-keyword">const</span> response = modified ? newResponse : oldResponse;

    <span class="hljs-comment">// Update the cache with the newer/fresher response</span>
    letsPretendThisIsSomeCache.set(newRequest.url, {policy, response}, policy.timeToLive());

    <span class="hljs-comment">// And proceed returning cached response as usual</span>
    response.headers = policy.responseHeaders();
    <span class="hljs-keyword">return</span> response;
}
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="yo-fresh"></a><a href="#yo-fresh" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Yo, FRESH</h1>
<p><img src="fresh.jpg" alt="satisfiesWithoutRevalidation"></p>
<h2><a class="anchor" aria-hidden="true" id="used-by"></a><a href="#used-by" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Used by</h2>
<ul>
<li><a href="https://imageoptim.com/api">ImageOptim API</a>, <a href="https://github.com/zkat/make-fetch-happen">make-fetch-happen</a>, <a href="https://www.npmjs.com/package/cacheable-request">cacheable-request</a>, <a href="https://github.com/npm/registry-fetch">npm/registry-fetch</a>, <a href="https://github.com/pornel/http-cache-semantics/network/dependents">etc.</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="implemented"></a><a href="#implemented" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implemented</h2>
<ul>
<li><code>Cache-Control</code> response header with all the quirks.</li>
<li><code>Expires</code> with check for bad clocks.</li>
<li><code>Pragma</code> response header.</li>
<li><code>Age</code> response header.</li>
<li><code>Vary</code> response header.</li>
<li>Default cacheability of statuses and methods.</li>
<li>Requests for stale data.</li>
<li>Filtering of hop-by-hop headers.</li>
<li>Basic revalidation request</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="unimplemented"></a><a href="#unimplemented" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unimplemented</h2>
<ul>
<li>Merging of range requests, If-Range (but correctly supports them as non-cacheable)</li>
<li>Revalidation of multiple representations</li>
</ul>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#usage">Usage</a><ul class="toc-headings"><li><a href="#constructor-options">Constructor options</a></li><li><a href="#storable"><code>storable()</code></a></li><li><a href="#satisfieswithoutrevalidationnewrequest"><code>satisfiesWithoutRevalidation(newRequest)</code></a></li><li><a href="#responseheaders"><code>responseHeaders()</code></a></li><li><a href="#timetolive"><code>timeToLive()</code></a></li><li><a href="#toobject-fromobjectjson"><code>toObject()</code>/<code>fromObject(json)</code></a></li><li><a href="#refreshing-stale-cache-revalidation">Refreshing stale cache (revalidation)</a></li></ul></li><li><a href="#used-by">Used by</a></li><li><a href="#implemented">Implemented</a></li><li><a href="#unimplemented">Unimplemented</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/underbase/" class="nav-home"><img src="/underbase/img/logo.svg" alt="Underbase" width="64" height="auto"/></a><div><h5>Guides</h5><a href="/underbase/docs/backups">Working with backups</a><a href="/underbase/docs/continuous-deployment">Working with continuous deployment</a><a href="/underbase/docs/api">API Reference</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/underbase" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/sundowndev" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/underbase/blog">Release notes</a><a href="https://github.com/sundowndev/underbase">GitHub</a></div></section></footer></div></body></html>